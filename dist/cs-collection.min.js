!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Immutable"),require("PubSub")):"function"==typeof define&&define.amd?define(["Immutable","PubSub"],t):"object"==typeof exports?exports.CsCollection=t(require("Immutable"),require("PubSub")):e.CsCollection=t(e.Immutable,e.PubSub)}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),f=r(u),l=function(){function e(t,n,r){if(i(this,e),!t||"object"!=("undefined"==typeof t?"undefined":o(t)))return void console.error("没有配置或者配置错误");window.collectionConfig=t,window.collectionI18n=n||"en","string"==typeof r?window.collectionMock=JSON.parse(r):window.collectionMock=r||{millis:34,code:"SUCCESS",message:"操作成功",entity:""};var a=window.localStorage.getItem("oldUrl")||"",u=!1;a.includes("mock")!=location.href.includes("mock")&&(u=!0,window.localStorage.setItem("oldUrl",location.href)),u&&window.localStorage.setItem("db","{}"),window.db={};var l=window.localStorage.getItem("db")||"{}";l=JSON.parse(l);for(var c in t){var s=!1;for(var d in l)d===c&&(s=!0);var y=[];s&&(y=l[c].items),window.db[c]=new f["default"](c,y)}}return a(e,[{key:"setCollectionI18n",value:function(e){window.collectionI18n=e||"en"}}]),e}();t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),c=n(9),s=r(c),d=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),f(t,null,[{key:"getList",value:function(e){return Array.isArray(e)?(0,l.List)(e):l.List.of()}},{key:"isMap",value:function(e){return l.Map.isMap(e)}},{key:"isList",value:function(e){return l.List.isList(e)}},{key:"getParamObj",value:function(e,n){var r={};if("object"==("undefined"==typeof e?"undefined":u(e)))r=n[1]?t.withoutKeyObj(e,n[0]):n[0]?t.getKeyObj(e,n[0]):e;else{if("string"!=typeof e)return!1;r=e}return!r||$.isEmptyObject(r)?(console.error("参数为空"),!1):r}},{key:"setLocalData",value:function(e,t){window.db[e].items=t,window.localStorage.setItem("db",JSON.stringify(window.db))}},{key:"updateData",value:function(e,n,r){var i=window.db&&window.db[e].items;if(i&&i.size>0){var o=function(){var o=(0,l.List)(),a=(0,l.List)();return i.forEach(function(e,t){if(e[r]==n[r]){var u;!function(){var r=(0,l.Map)(e);for(u in n)r.map(function(e,t){t==u&&(a=r.set(u,n[u]))});var f=a.toObject();f.cacheTime=(new Date).getTime(),o=i.set(t,f)}()}}),o&&o.size>0?t.setLocalData(e,o):console.error("更改的数据不存在！"),{v:a.toObject()}}();if("object"===("undefined"==typeof o?"undefined":u(o)))return o.v}else console.error("更改的数据不存在！")}},{key:"removeData",value:function(e,n,r){var i=window.db&&window.db[e].items;if(i&&i.size>0){var o=(0,l.List)(),a=!1,u=void 0;return i.forEach(function(e,t){e[r]==n&&(a=!0,o=i.remove(t),u=e)}),a?t.setLocalData(e,o):console.error("删除的数据不存在！"),u}console.error("删除的数据不存在！")}},{key:"getKeyObj",value:function(e,n){if(e&&!t.isEmpty(e)&&n){var r={},i=[];n.constructor==String?i.push(n):n.constructor==Array&&(i=n);for(var o=0;o<i.length;o++){var a=i[o];l.Map.isMap(e)?void 0!=e.get(a)&&(r[a]=e.get(a)):e.constructor==Object?void 0!=e[a]&&(r[a]=e[a]):e.constructor==Array&&void 0!=e[0][a]&&(r[a]=e[0][a])}return r}}},{key:"getListKeyObj",value:function(e,n){if(e&&n){for(var r=[],i=0;i<e.length;i++){var o=this.getKeyObj(e[i],n);t.isEmpty(o)||r.push(o)}return r}}},{key:"filterListKey",value:function(e,n){if(e&&!t.isEmpty(e)&&n)return l.List.isList(e)?this.filterMapListKey(e,n):e.constructor==Array?this.filterMapListKey((0,l.List)(e),n):void 0}},{key:"filterMapListKey",value:function(e,t){if(e&&t&&l.List.isList(e)){var n=(0,l.Map)(t),r=e.filter(function(e){var t=!0;return n.map(function(n,r){n!=(0,l.Map)(e).get(r)&&(t=!1)}),t});return r}}},{key:"withoutKeyObj",value:function(e,n){if(e&&!t.isEmpty(e)&&n){var r;if(l.Map.isMap(e))r=this.withoutMapKeyObj(e,n);else if(e.constructor==Object){var i=(0,l.Map)(e);r=this.withoutMapKeyObj(i,n)}else if(e.constructor==Array){r=[];for(var o=0;o<e.length;o++){var a=this.withoutMapKeyObj((0,l.Map)(e[o]),n);r.push(a)}}return r}}},{key:"withoutMapKeyObj",value:function(e,t){if(e&&t&&l.Map.isMap(e)){var n;if(t.constructor==String)n=e.filterNot(function(e,n){return t==n});else if(t.constructor==Array){var r=(0,l.List)(t);n=e.filterNot(function(e,t){return r.includes(t)})}return n.toObject()}}}]),t}(s["default"]);t["default"]=d},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(6),f=r(u),l=n(1),c=r(l),s=n(7),d=r(s),y=n(3),v=r(y),b=function(){function e(t,n){i(this,e),this.id=c["default"].uuid(),this.colName=t,this.items=c["default"].getList(n),this.widgets=[]}return a(e,[{key:"bindWidget",value:function(e,t){var n={};return n.id=e,n.colName=this.colName,n.pubsubKey=this.colName+"."+e,n.findOne=this.findOne.bind(n),n.find=this.find.bind(n),n.insert=this.insert.bind(n),n.update=this.update.bind(n),n.remove=this.remove.bind(n),n.pubsub=v["default"].subscribe(n.pubsubKey,t),n.unsubscribe=function(){v["default"].unsubscribe(n.pubsub)},this.widgets.push({widget:n}),n}},{key:"findOne",value:function(t,n){var r=this,i={};if(t&&"object"==("undefined"==typeof t?"undefined":o(t)))for(var a in t){var u=t[a];if("object"!=("undefined"==typeof u?"undefined":o(u)))i[a]=u;else for(var l in u){var c=u[l];if(0!=l.indexOf("$"))return!1;var s=l;try{var y=d["default"][s](c);if(!y)return!1;i[a]=y}catch(b){return!1}}}e.clearCacheData(this.colName,"findOne");for(var p=db[this.colName].widgets,m=0;m<p.length;m++)p[m].widget.id==this.id&&(p[m].query=t);if(!f["default"].isMock)return f["default"].findOne.bind(this)(this.colName,t,n).then(function(e){v["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));var h=f["default"].findOne.bind(this)(this.colName,t,n);if(h){if("function"==typeof h.then)return h.then(function(e){v["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));v["default"].publish(this.pubsubKey,h.nowItems)}}},{key:"find",value:function(t,n,r){var i=this,a={};if(t&&"object"==("undefined"==typeof t?"undefined":o(t)))for(var u in t){var l=t[u];if("object"!=("undefined"==typeof l?"undefined":o(l)))a[u]=l;else for(var c in l){var s=l[c];if(0!=c.indexOf("$"))return!1;var y=c;try{var b=d["default"][y](s);if(!b)return!1;a[u]=b}catch(p){return!1}}}e.clearCacheData(this.colName,"find");for(var m=db[this.colName].widgets,h=0;h<m.length;h++)m[h].widget.id==this.id&&(m[h].query=a);if(!f["default"].isMock)return f["default"].find.bind(this)(t,a,n,r).then(function(e){v["default"].publish(i.pubsubKey,e.nowItems)}.bind(this));var g=f["default"].find.bind(this)(t,a,n,r);if(g){if("function"==typeof g.then)return g.then(function(e){v["default"].publish(i.pubsubKey,e.nowItems)}.bind(this));var w=$.Deferred();return v["default"].publish(this.pubsubKey,g.nowItems),w.resolve(),w.promise()}}},{key:"insert",value:function(t,n){var r=this;if(e.clearCacheData(this.colName,"insert"),f["default"].isMock){var i=f["default"].insert.bind(this)(this.colName,t,n);if(i){if("function"==typeof i.then)return i.then(function(e){v["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));v["default"].publish(this.pubsubKey,i.nowItems)}}else{var a,u=function(){var i=f["default"].getRequestNum(r.colName),o=1,u=f["default"].insert.bind(r)(r.colName,t,n).then(function(t){v["default"].publish(r.pubsubKey,t.nowItems),e.publishRelated(r.colName)}.bind(r));return i>1&&(a=setInterval(function(){o==i-1&&clearInterval(a),f["default"].insert(this.colName,t,n),o++}.bind(r),50)),{v:u}}();if("object"===("undefined"==typeof u?"undefined":o(u)))return u.v}}},{key:"update",value:function(t,n){var r=this;if(e.clearCacheData(this.colName,"update"),!f["default"].isMock)return f["default"].update.bind(this)(this.colName,t,n).then(function(t){v["default"].publish(r.pubsubKey,t.nowItems),e.publishRelated(r.colName)}.bind(this));var i=f["default"].update.bind(this)(this.colName,t,n);if(i){if("function"==typeof i.then)return i.then(function(e){v["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));v["default"].publish(this.pubsubKey,i.nowItems)}}},{key:"remove",value:function(t,n){var r=this;if(e.clearCacheData(this.colName,"remove"),f["default"].isMock){var i=f["default"].remove.bind(this)(this.colName,t,n);if(i){if("function"==typeof i.then)return i.then(function(e){v["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));v["default"].publish(this.pubsubKey,i.nowItems)}}else{var a,u=function(){var i=f["default"].getRequestNum(r.colName),o=1,u=f["default"].remove.bind(r)(r.colName,t,n).then(function(t){v["default"].publish(r.pubsubKey,t.nowItems),e.publishRelated(r.colName)}.bind(r));return i>1&&(a=setInterval(function(){o==i-1&&clearInterval(a),f["default"].remove(this.colName,t,n),o++}.bind(r),50)),{v:u}}();if("object"===("undefined"==typeof u?"undefined":o(u)))return u.v}}}],[{key:"publishRelated",value:function(e){for(var t=window.db&&window.db[e]&&window.db[e].widgets,n=window.db&&window.db[e]&&window.db[e].items,r=0;r<t.length;r++)if(t[r].hasOwnProperty("query")){var i=t[r].query;if(c["default"].isEmpty(i))v["default"].publish(t[r].widget.pubsubKey,n);else{var o=c["default"].filterListKey(n,i);o&&v["default"].publish(t[r].widget.pubsubKey,o)}}}},{key:"clearCacheData",value:function(e,t){var n=f["default"].getCacheTimeOut(e),r=(new Date).getTime(),i=window.db&&window.db[e].items.toArray(),o=[];for(var a in i){var u=i[a].cacheTime;n!=-1&&r-n>u&&o.push(a)}o=o.reverse();for(var a=0;a<o.length;a++)i.splice(o[a],1);c["default"].setLocalData(e,c["default"].getList(i))}}]),e}();t["default"]=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),f=r(u),l=n(8),c=r(l),s=function(){function e(){i(this,e)}return a(e,null,[{key:"getKeyItems",value:function(e){var t=[];for(var n in e)t.push(n);return t}},{key:"mockUUID",value:function(t,n,r){if("object"===("undefined"==typeof t?"undefined":o(t))){var i=e.getKeyItems(t)[0],a=t[i].length||32,u="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";return t[i]=e.getRandomString(a,u),n[r]=t,n}}},{key:"createMockContent",value:function(t,n){var r=JSON.parse(JSON.stringify(t));if("object"===("undefined"==typeof r?"undefined":o(r))){var i=c["default"][e.mockLevel]||c["default"][e.level_1];return e.getMockData(r,i,n),r}}},{key:"getMockData",value:function(t,n,r){var i=e.getKeyItems(t);return i.forEach(function(i,a){if($.isArray(t[i])){var u=[],f=e.getRandomlength(n.array);if("object"!==o(t[i][0]))for(var l=0;l<f;l++)u.push(e.getItemValue(t[i][0],n));else{for(var c=0;c<f;c++){var s=JSON.parse(JSON.stringify(e.getMockData(t[i][0],n,r)));u[c]=s}t[i]=u}}else t[i]=e.getItemValue(r[i],n)}),t}},{key:"getItemValue",value:function(t,n){var r="";if("string"===t){var i=window.collectionI18n;r=e.getSpecialItem(i,n[i])}else if("int"===t)r=e.getSpecialItem("int",n["int"]);else if("money"===t){var o=e.getSpecialItem("int",n["int"]);r=parseFloat(o/100).toFixed(2)}else if("time"===t)r=(new Date).toString("yyyy-MM-dd");else if(f["default"].isObject(t))"time"===t.type&&(r=(new Date).toString(t.format));else if($.isArray(t)){var a=Math.floor(Math.random()*t.length);r=t[a]}return r}},{key:"getRandomlength",value:function(e){if(e&&2==e.length){var t=e[1]-e[0]+1,n=Math.random();return e[0]+Math.round(n*t)}}},{key:"getRandomString",value:function(e,t){for(var n=t.length,r="",i=0;i<e;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}},{key:"getSpecialItem",value:function(t,n){if(t&&n){if("int"==t){var r=e.getRandomlength(n),i="0123456789";return parseInt(e.getRandomString(r,i))}if("en"==t){var o=e.getRandomlength(n),a="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";return e.getRandomString(o,a)}if("zh"==t){for(var u=new Array,f=e.getRandomlength(n),l=0;l<f;l++)u[l]=Math.round(20927*Math.random())+19968;var c=new Array;for(var l in u)c.push(String.fromCodePoint(u[l]));return c.join("")}}}}]),e}();s.level_1="level_1",s.level_2="level_2",s.level_3="level_3",s.mockLevel=function(){var e=location.href;if(e.includes("mock")){var t=e.indexOf("mock")+5,n=e.indexOf("&",t);return n<0&&(n=e.length),e.substring(t,n)||s.level_1}}(),t["default"]=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(5),f=r(u),l=n(1),c=r(l),s=n(2),d=n(3),y=r(d),v=function(){function e(){o(this,e)}return a(e,null,[{key:"isMockUrl",value:function(e,t){var n=window.collectionConfig[e],r=n&&n[t],i=r&&r.mockUrl||"";return i}},{key:"getStoreParam",value:function(e,t){var n=window.collectionConfig[e],r=n&&n[t],i=r&&r.storeParam||"entity";return i}},{key:"getFields",value:function(e,t){var n=window.collectionConfig[e],r=(n&&n[t],n&&n.entity&&n.entity.fields);return r}},{key:"mock",value:function(t,n,r){var i=window.collectionConfig[t],o=i&&i[n],a=o&&o["return"],u=o&&o.structure||{millis:32,code:"SUCCESS",message:"操作成功",entity:""},l=e.getStoreParam(t,n),c=e.getPrimaryKey(t),s=e.getFields(t,n);if(!a||$.isEmptyObject(a)){var d=e.isMockUrl(t,n);return d?d:window.collectionMock}if(a.hasOwnProperty(c)&&1==e.getObjLength(a))return f["default"].mockUUID(a,u,l);if(a&&s){var y=f["default"].createMockContent(a,s);return u[l]=y,u}}},{key:"getObjLength",value:function(e){var t=0;for(var n in e)t++;return t}},{key:"getUrl",value:function(e,t,n,r){var i=window.collectionConfig[e],o=i&&i[t];return o&&o.getUrl(n,r)}},{key:"getReturnChain",value:function(e,t){var n=window.collectionConfig[e],r=n&&n[t];return r&&r.returnChain}},{key:"getCacheTimeOut",value:function(e){var t=window.collectionConfig[e];return t&&t.cacheTimeOut}},{key:"getRequestNum",value:function(e){var t=window.collectionConfig[e];return t&&t.requestNum}},{key:"getIsMongoQuery",value:function(e){var t=window.collectionConfig[e];return!!t.isMongoQuery&&t.isMongoQuery}},{key:"getPrimaryKey",value:function(e){var t=window.collectionConfig[e],n=t&&t.entity;return n&&n.primaryKey}},{key:"getParamValue",value:function(e,t){if(!e||!t)return!1;var n=c["default"].getKeyObj(e,t);return n?n[t]:(console.error("找不到该key值"),!1)}},{key:"getPrimaryKeyValue",value:function(t,n){var r="";if("string"==typeof n)r=n;else{var i=e.getPrimaryKey(t);r=e.getParamValue(n,i)}return r?r:(console.error("找不到主键值"),!1)}},{key:"getNowdbData",value:function(t,n,r,i,o){var a=[],u=e.getStoreParam(t,r),f=i[u];if(n){var l=n.split(".");a=i;for(var c=0;c<l.length;c++)a=a[l[c]]}else if(f[o])a=f;else for(var c in f)f[c]&&f[c].length>0&&(a=f[c]);return"findOne"==r&&a&&a.length>0&&(a=a[0]),a}},{key:"isInsert",value:function(e,t,n,r){var i=!0,o=window.db&&window.db[e]&&window.db[e].items,a=(0,s.List)();return o&&o.size>0&&o.forEach(function(e,u){if(e[r]==("string"==typeof n?n:n[r])&&(i=!1,"findOne"==t)){var f=$.extend({},e,n);a=o.set(u,f)}}),"findOne"==t?$.extend({isInsert:i},{extend:a}):i}},{key:"getDataKey",value:function(e,t){var n=window.collectionConfig[e];return n&&n[t]&&n[t].include?[n&&n[t]&&n[t].include,!1]:n&&n[t]&&n[t].exclusive?[n&&n[t]&&n[t].exclusive,!0]:["",!1]}},{key:"getTimeKey",value:function(t,n){var r=e.getFields(t,n),i=[];for(var o in r)c["default"].isObject(r[o])?"time"===r[o].type&&i.push(o):"time"===r[o]&&i.push(o);return i}},{key:"forKeyData",value:function(t,n,r){for(var i in t)if(c["default"].isObject(t[i]))e.forKeyData(t[i],n,r);else for(var o in n)i===n[o]&&(t[i]=new Date(t[i]).toString(r[i].format?r[i].format:"yyyy-MM-dd"));return t}},{key:"getTimeData",value:function(t,n,r){var i=e.getFields(t,n),o=e.getTimeKey(t,n);return e.forKeyData(r,o,i)}},{key:"findOne",value:function(t,n,r){var i=this,o="findOne";if(e.isMock){var a=e.mock(t,o,n);return"string"==typeof a?$.getJSON(a,null,function(n){e.setFindOneData(t,o,n)}):e.setFindOneData(t,o,a)}var u=e.getIsMongoQuery(t),f=e.getPrimaryKey(t),l=e.getPrimaryKeyValue(t,n);if(db&&db.size>0&&db.forEach(function(e,t){e[f]==l&&y["default"].publish(i.pubsubKey,(0,s.Map)(e))}),u)var c="/"+t+"?query="+n;else var c=e.getUrl(t,"findOne",l,r);return $.get(c,null,function(n){"SUCCESS"===n.code&&(n=e.getTimeData(t,o,n),e.setFindOneData(t,o,n))})}},{key:"setFindOneData",value:function(t,n,r){var i=e.getReturnChain(t,n),o=e.getPrimaryKey(t),a=e.getNowdbData(t,i,n,r,o);if(!a)return void console.error(t+"返回链"+i+"，配置有误！");a.cacheTime=(new Date).getTime();var u=e.isInsert(t,n,a,o),f=window.db&&window.db[t]&&window.db[t].items;return u.isInsert&&f&&c["default"].setLocalData(t,window.db[t].items.push(a)),!u.isInsert&&f&&c["default"].setLocalData(t,u.extend),r.nowItems=(0,s.Map)(a),r}},{key:"find",value:function(t,n,r,i){var o=this,a="find";if(e.isMock){var u=e.mock(this.colName,a,n);return"string"==typeof u?$.getJSON(u,null,function(t){e.setFindData(o.colName,a,t)}):e.setFindData(this.colName,a,u)}var f=window.db&&window.db[this.colName]&&window.db[this.colName].items,l=c["default"].filterListKey(f,n);l&&y["default"].publish(this.pubsubKey,l);var s=e.getIsMongoQuery(this.colName);if(s)var d="/"+this.colName+"?query="+t;else var d=e.getUrl(this.colName,a,r,i);return $.get(d,n,function(t){"SUCCESS"===t.code&&(t=e.getTimeData(o.colName,a,t),e.setFindData(o.colName,a,t))})}},{key:"setFindData",value:function(t,n,r){var i=e.getReturnChain(t,n),o=e.getPrimaryKey(t),a=e.getNowdbData(t,i,n,r,o);if(window.db[t].result=r,!a)return void console.error(t+"返回链"+i+"，配置有误！");var u=window.db&&window.db[t]&&window.db[t].items;if(u&&u.size>0){var f=(0,s.List)();for(var l in a){var d=!0;u=f.size>0?f:u,u.forEach(function(e,t){a[l].cacheTime=(new Date).getTime(),e[o]==a[l][o]&&(d=!1,f=u.set(t,a[l]))}),d?c["default"].setLocalData(t,window.db[t].items.push(a[l])):c["default"].setLocalData(t,f)}}else if(u)for(var y in a)a[y].cacheTime=(new Date).getTime(),c["default"].setLocalData(t,window.db[t].items.push(a[y]));return r.nowItems=(0,s.List)(a),r}},{key:"insert",value:function(t,n,r){var i="insert",o=e.getDataKey(t,i),a=c["default"].getParamObj(n,o);if(e.isMock){var u=e.mock(t,i,n);return"string"==typeof u?$.getJSON(u,null,function(n){e.setInsertData(t,i,n,a)}):e.setInsertData(t,i,u,a)}return $.post(e.getUrl(t,i,n,r),a,function(n){"SUCCESS"===n.code&&(n=e.getTimeData(t,i,n),e.setInsertData(t,i,n,a))})}},{key:"setInsertData",value:function(t,n,r,o){var a=e.getPrimaryKey(t),u=e.getStoreParam(t,n),f=r[u],l=e.isInsert(t,n,f,a);if(l){var c=$.extend({cacheTime:(new Date).getTime()},o);if("string"==typeof f)c=$.extend(c,i({},a,f));else for(var d in f)c=$.extend(c,i({},d,f[d]));var y=window.db&&window.db[t]&&window.db[t].items;return y&&(window.db[t].items=window.db[t].items.push(c),window.localStorage.setItem("db",JSON.stringify(window.db))),r.nowItems=(0,s.Map)(c),r}console.error("已存在此数据，不能重复新建！")}},{key:"update",value:function(t,n,r){var i="update";if(e.isMock){var o=e.mock(t,i,n);return"string"==typeof o?$.getJSON(o,null,function(r){e.setUpdateData(t,i,r,n)}):e.setUpdateData(t,i,o,n)}var a=e.getDataKey(t,i),u=c["default"].getParamObj(n,a),f=e.getPrimaryKeyValue(t,n);return $.put(e.getUrl(t,i,f,r),u,function(r){"SUCCESS"===r.code&&(r=e.getTimeData(t,i,r),e.setUpdateData(t,i,r,n))})}},{key:"setUpdateData",value:function(t,n,r,i){var o=e.getPrimaryKey(t),a=e.getStoreParam(t,n),u=r[a];return u&&u.length>0?(r.nowItems=(0,s.Map)(c["default"].updateData(t,u,o)),r):(r.nowItems=(0,s.Map)(c["default"].updateData(t,i,o)),r)}},{key:"remove",value:function(t,n,r){var i="remove",o=e.getPrimaryKey(t),a=e.getPrimaryKeyValue(t,n);if(e.isMock){var u=e.mock(t,i,n);return"string"==typeof u?$.getJSON(u,null,function(e){e.nowItems=(0,s.Map)(c["default"].removeData(t,a,o))}):(u.nowItems=(0,s.Map)(c["default"].removeData(t,a,o)),u)}return $["delete"](e.getUrl(t,i,n,r),null,function(n){"SUCCESS"===n.code&&(n=e.getTimeData(t,i,n),n.nowItems=(0,s.Map)(c["default"].removeData(t,a,o)))})}}]),e}();v.initJquery=function(){$.ajaxSetup({cache:!1}),$(document).ajaxSend(function(e,t,n){}),$(document).ajaxSuccess(function(e,t,n){}),$(document).ajaxError(function(e,t,n,r){}),jQuery.each(["put","delete"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r||"json",r=n,n=void 0),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}})}(),v.isMock=function(){var e=!1,t=location.href;return t.includes("mock")&&(e=!0),e}(),t["default"]=v},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,null,[{key:"$in",value:function(e){return!!Array.isArray(e)&&e.toString()}}]),e}();t["default"]=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={level_1:{en:[5,50],zh:[1,20],"int":[1,10],array:[0,20]},level_2:{en:[50,100],zh:[20,80],"int":[10,20],array:[20,80]},level_3:{en:[100,200],zh:[80,150],"int":[20,100],array:[80,150]}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2),u=function(){function e(){r(this,e)}return o(e,null,[{key:"pushPollFuns",value:function(t){var n=t;"object"===("undefined"==typeof t?"undefined":i(t))&&(n=t.func),"function"==typeof n&&e.pollFuns.push(t)}},{key:"getKey",value:function(t){var n=(t||"key")+"_";return e.key=e.key+1,n+e.key}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}},{key:"isEmpty",value:function(e){if(!e)return!0;if(a.List.isList(e)||a.Map.isMap(e))return!(e.size>1);if(this.isArray(e))return 0==e.length;if(this.isObject(e)){for(var t in e)return!1;return!0}return!1}},{key:"isObject",value:function(e){var t="undefined"==typeof e?"undefined":i(e);return"function"===t||"object"===t&&!!e}},{key:"isArray",value:function(e){return Array.isArray(e)||"[object Array]"===toString.call(e)}}]),e}();u.pollFuns=[],u.poll=function(){setInterval(function(){for(var e in u.pollFuns){var t=u.pollFuns[e];"function"==typeof t?t():(t.cur=(t.cur||t.delay)-1,t.cur<1&&("function"==typeof t.func&&t.func(),t.cur=t.delay))}},1e3)}(),u.key=0,t["default"]=u}])});